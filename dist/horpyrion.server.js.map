{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap ca84a49ad35e0127a01f","webpack:///external \"babel-polyfill\"","webpack:///./src/index.js","webpack:///./src/Horpyrion.js","webpack:///./src/UserContext.js","webpack:///./src/ResourceContext.js","webpack:///./src/actions/createResource.js","webpack:///./src/actions/createRecord.js","webpack:///./src/throwIfNoSync.js","webpack:///./src/ModelManager.js","webpack:///external \"fs\"","webpack:///external \"path\"","webpack:///external \"sequelize\"","webpack:///external \"function-overloader\""],"names":["default","Horpyrion","configuration","_configuration","options","_modelManager","ModelManager","authenticate","sync","UserContext","ROOT_USER_ID","userId","getDbInstance","modelManager","_userId","resourceName","ResourceContext","CreateResource","Symbol","_resourceName","attributeName","attributeType","recordId","data","then","createResource","getModels","EntitySchema","create","name","entitySchema","id","findOne","where","include","model","Attribute","EntityRecord","EntitySchemaId","entityRecord","throwIfNoSync","isSync","Promise","resolve","reject","Error","_isSync","when","Overload","INSTANCE","Sequelize","do","_sequelize","sequelize","else","config","dbname","user","password","dialect","type","port","host","logging","execute","arguments","_models","fs","readdirSync","path","join","__dirname","filter","file","indexOf","forEach","import","Object","values","associate","console","log","catch","error","err"],"mappings":"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","file":"horpyrion.server.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ca84a49ad35e0127a01f","module.exports = require(\"babel-polyfill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill\"\n// module id = 1\n// module chunks = 0","export default from \"./Horpyrion\";\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import UserContext from \"./UserContext\";\nimport ModelManager from \"./ModelManager\";\n\nexport default class Horpyrion {\n    constructor(configuration) {\n        this._configuration = configuration;\n    }\n    async sync(options) {\n        this._modelManager = new ModelManager(this._configuration);\n        await this._modelManager.authenticate();\n        await this._modelManager.sync(options);\n    }\n\n    getRootUser() {\n        return new UserContext(UserContext.ROOT_USER_ID, this._modelManager);\n    }\n\n    getUser(userId) {\n        return new UserContext(userId, this._modelManager);\n    }\n\n    getDbInstance() {\n        return this._modelManager.getDbInstance();\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Horpyrion.js","import ResourceContext from \"./ResourceContext\";\n\nexport default class UserContext {\n    static ROOT_USER_ID = Symbol(\"ROOT_USER_ID\");\n    constructor(userId, modelManager) {\n        this._userId = userId;\n        this._modelManager = modelManager;\n    }\n\n    async createResource(resourceName) {\n        return ResourceContext.CreateResource(resourceName, this._userId, this._modelManager);\n    }\n\n    getResource(resourceName) {\n        return new ResourceContext(resourceName, this._userId, this._modelManager);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/UserContext.js","import createResource from \"./actions/createResource\";\nimport createRecord from \"./actions/createRecord\";\nimport throwIfNoSync from \"./throwIfNoSync\";\n\nexport default class ResourceContext {\n    constructor(resourceName, userId, modelManager) {\n        this._resourceName = resourceName;\n        this._userId = userId;\n        this._modelManager = modelManager;\n    }\n\n    static async CreateResource(resourceName, userId, modelManager) {\n        return throwIfNoSync(modelManager).then(() => createResource(resourceName, userId, modelManager));\n    }\n\n    async addAttribute(attributeName, attributeType) {\n        return false;\n    }\n\n    async getRecord(recordId) {\n        return false;\n    }\n\n    async getRecords() {\n        return false;\n    }\n\n    async createRecord(data) {\n        return throwIfNoSync(this._modelManager).then(() =>\n            createRecord(this._resourceName, this._userId, data, this._modelManager)\n        );\n    }\n\n    async updateRecord() {\n        return false;\n    }\n\n    async getAttributes() {\n        return false;\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ResourceContext.js","export default function createResource(resourceName, userId, modelManager) {\n    return modelManager\n        .getModels()\n        .EntitySchema.create(\n            {\n                name: resourceName\n            },\n            {}\n        )\n        .then(entitySchema => entitySchema.id);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/actions/createResource.js","export default function createResource(resourceName, userId, data, modelManager) {\n    return modelManager\n        .getModels()\n        .EntitySchema.findOne({\n            where: {\n                name: resourceName\n            },\n            include: [\n                {\n                    model: modelManager.getModels().Attribute\n                }\n            ]\n        })\n        .then(entitySchema => {\n            // TODO: test data with entitySchema\n            // for now assume that it pass\n            return modelManager.getModels().EntityRecord.create({\n                EntitySchemaId: entitySchema.id,\n                data: data\n            });\n        })\n        .then(entityRecord => entityRecord.id);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/actions/createRecord.js","export default function throwIfNoSync(modelManager) {\n    if (modelManager && modelManager.isSync()) {\n        return Promise.resolve();\n    } else {\n        return Promise.reject(new Error(\"No synchronization with database. Run sync() method\"));\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/throwIfNoSync.js","import fs from \"fs\";\nimport path from \"path\";\nimport Sequelize from \"sequelize\";\nimport Overload from \"function-overloader\";\n\nexport default class ModelManager {\n    constructor() {\n        this._isSync = false;\n        Overload.when(Overload.INSTANCE(Sequelize))\n            .do(sequelize => {\n                this._sequelize = sequelize;\n            })\n            .else(config => {\n                this._sequelize = new Sequelize(config.dbname, config.user, config.password, {\n                    dialect: config.type,\n                    port: config.port,\n                    host: config.host,\n                    logging: config.logging\n                });\n            })\n            .execute(...arguments);\n        this._models = {};\n        fs.readdirSync(path.join(__dirname, \"models\"))\n            .filter(file => {\n                return file.indexOf(\".\") !== 0;\n            })\n            .forEach(file => {\n                const model = this._sequelize.import(path.join(__dirname, \"models\", file));\n                this._models[model.name] = model;\n            });\n        Object.values(this._models).forEach(model => {\n            if (model.associate) {\n                model.associate(this._models);\n            }\n        });\n    }\n\n    getDbInstance() {\n        return this._sequelize;\n    }\n\n    async sync(options) {\n        return this._sequelize.sync(options).then(() => {\n            this._isSync = true;\n        });\n    }\n\n    isSync() {\n        return this._isSync;\n    }\n\n    getModels() {\n        return this._models;\n    }\n\n    async authenticate() {\n        return this._sequelize\n            .authenticate()\n            .then(() => {\n                console.log(\"Connection has been established successfully.\");\n            })\n            .catch(err => {\n                console.error(\"Unable to connect to the database:\", err);\n            });\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ModelManager.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"sequelize\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sequelize\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"function-overloader\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"function-overloader\"\n// module id = 13\n// module chunks = 0"],"sourceRoot":""}